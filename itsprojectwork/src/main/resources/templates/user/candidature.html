<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Profilo Utente</title>
    <link rel="stylesheet" th:href="@{/css/user/style.css}" /> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

</head>

<body>

    <a th:href="@{/dashboard}" class="dashboard-btn" title="Torna alla dashboard">‚Üê Dashboard</a>
    
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" id="theme-toggle-btn" title="Attiva/Disattiva modalit√† scura">
        <span class="slider">
            <span class="icon sun">‚òÄÔ∏è</span>
            <span class="icon moon">üåô</span>
        </span> 
    </button>
    
    <div class="profile-container">

        <div class="header-row">
            <h2>Profilo utente</h2>
            
            <div class="profile-pic-wrapper">
                <img id="profile-image" 
                     th:src="@{${utente.immagine != null ? utente.immagine : '/img/default_profile.svg'}}" 
                     alt="Immagine Profilo" />
                <label for="upload-image" title="Cambia immagine profilo">üì∑</label>
                <input type="file" id="upload-image" accept="image/*" />
            </div>
        </div>

        <form> 
            <div class="form-group-row">
                <div class="form-group half">
                    <h1 th:text="'Ciao, ' + ${utente.nome} + '!'">Ciao, Cristina!</h1> 
                </div>
            </div>
            
            <a th:href="@{/users/profilo/modifica}" class="btnModifica" title="modifica">Modifica Profilo</a>
            
            <div class="form-group">
                <label for="bio">Biografia</label>
                <textarea name="bio" id="bio" th:text="${utente.bio}" readonly></textarea>
            </div>
        </form>

        <div class="candidature">
            <h2>Le mie candidature</h2>
            <div class="button-container">
                <button class="btn btn-attesa">ATTESA</button>
                <button class="btn btn-accettate">ACCETTATE</button>
                <button class="btn btn-rifiutate">RIFIUTATE</button>
                <button class="btn btn-altro">TUTTE</button>
            </div>
        </div>

        <div class="annunci-grid">

            <div class="annuncio-card" th:each="candidatura : ${candidature}">
                
                <div class="annuncio-titolo" th:text="${candidatura.annuncio.titolo}">Titolo</div>

                <div class="dati-annuncio">
                    
                    <div class="dato-item stato-candidatura">
                        <span class="etichetta">Stato:</span>
                        <span class="valore" th:text="${candidatura.stato}">PENDING</span>
                    </div>

                    <div class="dato-item">
                        <span class="etichetta">Azienda:</span>
                        <span class="valore" th:text="${candidatura.annuncio.azienda != null ? candidatura.annuncio.azienda.nome : '‚Äî'}">‚Äî</span>
                    </div>

                    <div class="dato-item">
                        <span class="etichetta">Durata:</span>
                        <span class="valore">
                            <span th:text="${candidatura.annuncio.data_inizio}">2025-01-01</span> -
                            <span th:text="${candidatura.annuncio.data_fine}">2025-03-31</span>
                        </span>
                    </div>

                    <div class="dato-item">
                        <span class="etichetta">Mansione:</span>
                        <span class="valore" th:text="${candidatura.annuncio.tipoMansione}">‚Äî</span>
                    </div>

                    <div class="dato-item">
                        <span class="etichetta">Competenze Richieste:</span>
                        <div class="competence-tags">
                            <span class="tag" th:each="comp, iStat : ${candidatura.annuncio.competenzeRichieste}" th:if="${iStat.index < 4}"
                                th:text="${comp.descrizione}">Skill</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div th:if="${candidature.empty}">
                <p>Non hai ancora candidature attive.</p>
            </div>

        </div>

        <div class="pagination">
            <button onclick="prevPage()"><i class="fas fa-chevron-left"></i></button>
            <span id="page-indicator">1</span>
            <button onclick="nextPage()"><i class="fas fa-chevron-right"></i></button>
        </div>

    </div>

    <script>
        // ****** Logica Dark Mode ******
        function toggleDarkMode() {
            const isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('dark-mode', isDark);
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            const prefersDark = localStorage.getItem('dark-mode') === 'true';
            if (prefersDark) {
                document.body.classList.add('dark-mode');
            }
        });
        // ****** Fine Logica Dark Mode ******


        // Anteprima immagine profilo
        const imageInput = document.getElementById('upload-image');
        const profileImg = document.getElementById('profile-image');

        imageInput.addEventListener('change', function () {
            const file = this.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    profileImg.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                alert("Seleziona un file immagine valido.");
            }
        });

        // Paginazione annunci (logica JavaScript per il client)
        const annunciPerPagina = 3;
        let paginaCorrente = 1;

        const tutteLeCard = Array.from(document.querySelectorAll('.annuncio-card'));
        const indicatorePagina = document.getElementById('page-indicator');

        function mostraPagina(pagina) {
            const start = (pagina - 1) * annunciPerPagina;
            const end = start + annunciPerPagina;

            tutteLeCard.forEach((card, index) => {
                card.style.display = (index >= start && index < end) ? 'block' : 'none';
            });

            indicatorePagina.textContent = pagina;
        }

        function nextPage() {
            if (paginaCorrente * annunciPerPagina < tutteLeCard.length) {
                paginaCorrente++;
                mostraPagina(paginaCorrente);
            }
        }

        function prevPage() {
            if (paginaCorrente > 1) {
                paginaCorrente--;
                mostraPagina(paginaCorrente);
            }
        }

        mostraPagina(paginaCorrente);
    </script>
</body>

</html>