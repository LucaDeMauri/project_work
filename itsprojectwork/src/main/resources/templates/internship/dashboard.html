<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - StageUp</title>
  <link rel="stylesheet" th:href="@{/css/internship/dashboard.css}">
</head>
<body>
<header>
  <div class="header-left">
    <img src="/img/logo.png" alt="StageUp Logo" class="logo">
    <h1>Stage Up</h1>
  </div>
  <div class="header-right">
    <button class="dark-mode-toggle" id="darkModeToggle" onclick="toggleDarkMode()">üåì</button>
    <div class="user-menu">
      <div class="user-avatar" id="userAvatar"><span>U</span></div>
      <div class="dropdown-menu" id="dropdownMenu">
        <a href="/profilo" class="dropdown-item">
          <span class="dropdown-icon">üë§</span>
          Profilo Utente
        </a>
        <div class="dropdown-divider"></div>
        <a th:href="@{/auth/logout}" class="dropdown-item logout">
          <span class="dropdown-icon">üö™</span>
          Logout
        </a>
      </div>
    </div>
  </div>
</header>

<div class="container">
  <div class="annunci-grid" id="annunciGrid">
    <!-- Card generate da Thymeleaf -->
    <div class="annuncio-card"
         th:each="a : ${listaAnnunci}">

      <!-- Titolo card -->
      <div class="annuncio-titolo" th:text="${a.titolo}">Titolo</div>

      <!-- Dati sintetici nella card -->
      <div class="dati-annuncio">
        <div class="dato-item">
          <span class="etichetta">Azienda:</span>
          <span class="valore" th:text="${a.azienda != null ? a.azienda.nome : '‚Äî'}">‚Äî</span>
        </div>

        <div class="dato-item">
          <span class="etichetta">Durata:</span>
          <span class="valore">
            <span th:text="${a.data_inizio}">2025-01-01</span> -
            <span th:text="${a.data_fine}">2025-03-31</span>
          </span>
        </div>

        <div class="dato-item">
          <span class="etichetta">Mansione:</span>
          <span class="valore" th:text="${a.tipoMansione}">‚Äî</span>
        </div>

        <div class="dato-item">
          <span class="etichetta">Competenze:</span>
          <div class="competence-tags">
            <span class="tag"
                  th:each="c, iStat : ${a.competenzeRichieste}"
                  th:if="${iStat.index < 4}"
                  th:text="${c.descrizione}">Skill</span>
          </div>
        </div>
      </div>

      <button class="btn-candidati" type="button">Dettagli</button>

      <!-- TEMPLATE NASCOSTO per l'overlay (renderizzato lato server) -->
      <div class="overlay-template" style="display:none">
        <h2 class="overlay-title" th:text="${a.titolo}">Titolo</h2>

        <div class="overlay-body-content">
          <div class="overlay-section">
            <h3>Informazioni Azienda</h3>
            <p><strong>Azienda:</strong> <span th:text="${a.azienda != null ? a.azienda.nome : '‚Äî'}">‚Äî</span></p>
            
            <p><strong>Sede:</strong> <span th:text="${a.location}">‚Äî</span></p>
          </div>

          <div class="overlay-section">
            <h3>Dettagli Stage</h3>
            <p><strong>Tipo mansione:</strong> <span th:text="${a.tipoMansione}">‚Äî</span></p>
            <p><strong>Inizio:</strong> <span th:text="${a.data_inizio}">‚Äî</span></p>
            <p><strong>Fine:</strong> <span th:text="${a.data_fine}">‚Äî</span></p>
            <p th:if="${a.orari != null}">
              <strong>Orari:</strong> <span th:text="${a.orari}"></span>
            </p>
          </div>

          <div class="overlay-section"
               th:if="${a.competenzeRichieste != null and !#lists.isEmpty(a.competenzeRichieste)}">
            <h3>Competenze Richieste</h3>
            <div class="competence-tags-large">
              <span class="tag" th:each="c : ${a.competenzeRichieste}" th:text="${c.descrizione}">Skill</span>
            </div>
          </div>

          <div class="overlay-section"
               th:if="${a.competenzeAcquisite != null and !#lists.isEmpty(a.competenzeAcquisite)}">
            <h3>Competenze che Acquisirai</h3>
            <div class="competence-tags-large">
              <span class="tag" th:each="c : ${a.competenzeAcquisite}" th:text="${c.descrizione}">Skill</span>
            </div>
          </div>

          <div class="overlay-section" th:if="${a.descrizione != null}">
            <h3>Descrizione</h3>
            <p th:text="${a.descrizione}">‚Äî</p>
          </div>
        </div>
      </div>
      <!-- /overlay-template -->
    </div>
  </div>
</div>

<!-- Overlay globale -->
<div class="overlay" id="overlay">
  <div class="overlay-content">
    <button class="btn-close-overlay" id="btnCloseOverlay" type="button">√ó</button>
    <div class="overlay-header">
      <h2 id="overlayTitolo"></h2>
    </div>
    <div class="overlay-body" id="overlayBody"><!-- popolato da JS --></div>
    <div class="overlay-footer">
      <button class="btn-conferma-candidatura" id="btnConfermaCandidatura" type="button">
        Conferma Candidatura
      </button>
    </div>
  </div>
</div>

<script>
	
document.addEventListener('DOMContentLoaded', function () {
  const userAvatar = document.getElementById('userAvatar');
  const dropdownMenu = document.getElementById('dropdownMenu');
  const grid = document.getElementById('annunciGrid');

  const overlay = document.getElementById('overlay');
  const overlayTitolo = document.getElementById('overlayTitolo');
  const overlayBody = document.getElementById('overlayBody');
  const btnCloseOverlay = document.getElementById('btnCloseOverlay');
  const btnConfermaCandidatura = document.getElementById('btnConfermaCandidatura');

  // Dropdown utente
  userAvatar.addEventListener('click', function (e) {
    e.preventDefault(); e.stopPropagation();
    dropdownMenu.classList.toggle('show');
  });
  document.addEventListener('click', function (e) {
    if (!userAvatar.contains(e.target) && !dropdownMenu.contains(e.target)) {
      dropdownMenu.classList.remove('show');
    }
  });

  // Delego i click sui pulsanti "Dettagli" dentro la griglia
  grid.addEventListener('click', function (e) {
    const btn = e.target.closest('.btn-candidati');
    if (!btn) return;

    const card = btn.closest('.annuncio-card');
    if (!card) return;

    const tmpl = card.querySelector('.overlay-template');
    if (!tmpl) return;

    // Copio titolo e body dal template Thymeleaf della card
    const titleEl = tmpl.querySelector('.overlay-title');
    const bodyEl  = tmpl.querySelector('.overlay-body-content');

    overlayTitolo.textContent = titleEl ? titleEl.textContent : 'Dettagli';
    overlayBody.innerHTML = bodyEl ? bodyEl.innerHTML : '';

    // Mostro overlay
    overlay.classList.add('show');
    document.body.classList.add('overlay-open');
  });

  // Chiusura overlay
  btnCloseOverlay.addEventListener('click', closeOverlay);
  overlay.addEventListener('click', function (e) {
    if (e.target === overlay) closeOverlay();
  });
  document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape' && overlay.classList.contains('show')) closeOverlay();
  });
  btnConfermaCandidatura.addEventListener('click', function () {
    alert('Candidatura inviata con successo!');
    closeOverlay();
  });

  function closeOverlay() {
    overlay.classList.remove('show');
    document.body.classList.remove('overlay-open');
  }
});

// Dark mode
function toggleDarkMode() {
  const body = document.body;
  const darkModeToggle = document.getElementById('darkModeToggle');
  body.classList.toggle('dark-mode');
  darkModeToggle.innerHTML = body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåì';
}
</script>
</body>
</html>
